<div class="container">
  <h1>Reportes</h1>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <%= form_tag('/reports', method: :get) do %>
        <%= label_tag(:start_date, "Fecha Inicio: ") %>
        <%= date_select :start_date, :start_date, {order: [:day, :month, :year], use_month_numbers: true, start_year: Date.today.year - 1, end_year: Date.today.year + 1} %>
        <br>
        <%= label_tag(:end_date, "Fecha Fin: ") %>
        &nbsp;&nbsp;&nbsp;
        <%= date_select :end_date, :end_date, {order: [:day, :month, :year], use_month_numbers: true, start_year: Date.today.year - 1, end_year: Date.today.year + 1} %>
        <br>
        <%= submit_tag "Generar Reporte" , class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
  <br>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Consultas totales</th>
          <th>Consultas de psicología</th>
          <th>Consultas de nutrición</th>
          <th>Ingreso Total</th>
          <th>Ingreso de psicología</th>
          <th>Ingreso de nutrición</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= @appointments.count %></td>
          <th><%= @appointments.map(&:appointment_type).count("psicologo") %></th>
          <th><%= @appointments.map(&:appointment_type).count("nutriologo") %></th>
          <th>$<%= @appointments.sum("price") %></th>
          <th>$<%= @appointments.where(therapist_id: Therapist.all.where(therapist_type: "psicologo").map(&:id)).sum("price") %></th>
          <th><%= @appointments.where(therapist_id: Therapist.all.where(therapist_type: "nutriologo").map(&:id)).sum("price") %></th>
        </tr>
      </tbody>
    </table>
    </div>
  </div>
</div>